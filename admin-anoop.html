<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoboTechnique Admin Panel</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide.js"></script>
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function AdminPanel() {
            // Supabase Configuration - USING SERVICE ROLE KEY
            const [supabase, setSupabase] = useState(null);
            const [supabaseStatus, setSupabaseStatus] = useState('loading');
            const [debugInfo, setDebugInfo] = useState('');
            
            // Authentication State
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [password, setPassword] = useState('');
            const [showPassword, setShowPassword] = useState(false);
            const [loginError, setLoginError] = useState('');

            // ADMIN PASSWORD
            const ADMIN_PASSWORD = 'RoboAnoop2025';

            // Initialize Supabase with SERVICE ROLE KEY
            useEffect(() => {
                const initSupabase = async () => {
                    try {
                        const SUPABASE_URL = 'https://lpylrmsbmivlbonsytwv.supabase.co';
                        const SUPABASE_SERVICE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxweWxybXNibWl2bGJvbnN5dHd2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MjAxMzgwMywiZXhwIjoyMDc3NTg5ODAzfQ.jRqHiaKTT23IWPHJ4UMZGNx0r3xK45gk5M5sYY8EBOw';
                        
                        const { createClient } = window.supabase;
                        const client = createClient(SUPABASE_URL, SUPABASE_SERVICE_KEY);
                        setSupabase(client);
                        
                        // Test connection
                        const { data, error } = await client.from('products').select('*').limit(1);
                        if (error) {
                            console.error('Supabase connection failed:', error);
                            setSupabaseStatus('error');
                            setDebugInfo('Connection failed: ' + error.message);
                        } else {
                            console.log('Supabase connected successfully with service role key');
                            setSupabaseStatus('connected');
                            setDebugInfo('âœ… Connected with full admin privileges (Service Role Key)');
                        }
                    } catch (error) {
                        console.error('Error initializing Supabase:', error);
                        setSupabaseStatus('error');
                        setDebugInfo('Initialization error: ' + error.message);
                    }
                };

                initSupabase();
            }, []);

            // Load data from Supabase
            const loadInitialData = async () => {
                try {
                    // Load products from Supabase
                    if (supabase && supabaseStatus === 'connected') {
                        const { data: productsData, error: productsError } = await supabase
                            .from('products')
                            .select('*')
                            .order('title', { ascending: true });

                        if (productsError) {
                            console.error('Error loading products:', productsError);
                            setDebugInfo('Products load error: ' + productsError.message);
                            throw productsError;
                        }

                        // Load settings from Supabase
                        const { data: settingsData, error: settingsError } = await supabase
                            .from('settings')
                            .select('*')
                            .eq('id', 1)
                            .single();

                        if (settingsError && settingsError.code !== 'PGRST116') {
                            console.warn('Error loading settings:', settingsError);
                            // Create default settings if they don't exist
                            const defaultSettings = getDefaultSettings();
                            await saveSettingsToSupabase(defaultSettings);
                            return {
                                products: productsData || [],
                                settings: defaultSettings
                            };
                        }

                        console.log('Data loaded successfully from Supabase');
                        return {
                            products: productsData || [],
                            settings: settingsData || getDefaultSettings()
                        };
                    }

                    // Fallback to localStorage
                    const savedData = localStorage.getItem('robotechniqueData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        return {
                            products: data.products || [],
                            settings: data.settings || getDefaultSettings()
                        };
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    setDebugInfo('Load data error: ' + error.message);
                }
                
                return {
                    products: [],
                    settings: getDefaultSettings()
                };
            };

            const getDefaultSettings = () => ({
                freeShippingThreshold: 5000,
                shippingCost: 100,
                whatsappNumber: '919718335330',
                amazonLink: 'https://www.amazon.in/l/27943762031?me=A2NRJEQ5QH7HFB&tag=ShopReferral_7932ea5a-6372-4c7b-87f9-3d88e09214f4&ref=sf_seller_app_share_new_ls_srb'
            });

            const [products, setProducts] = useState([]);
            const [freeShippingThreshold, setFreeShippingThreshold] = useState(5000);
            const [shippingCost, setShippingCost] = useState(100);
            const [whatsappNumber, setWhatsappNumber] = useState('919718335330');
            const [amazonLink, setAmazonLink] = useState('https://www.amazon.in/l/27943762031?me=A2NRJEQ5QH7HFB&tag=ShopReferral_7932ea5a-6372-4c7b-87f9-3d88e09214f4&ref=sf_seller_app_share_new_ls_srb');

            const [activeTab, setActiveTab] = useState('products');
            const [savedNotification, setSavedNotification] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [dataLoaded, setDataLoaded] = useState(false);

            const categories = ['Actuation', 'Sensing', 'Kits', 'Control'];
            
            // Track temporary IDs to prevent duplicates
            const tempIdTracker = useRef(new Set());

            // Initialize data - FIXED: Only load data once after authentication
            useEffect(() => {
                const initializeData = async () => {
                    if (isAuthenticated && supabaseStatus === 'connected') {
                        setDebugInfo('Loading data with admin privileges...');
                        const data = await loadInitialData();
                        setProducts(data.products);
                        setFreeShippingThreshold(data.settings.freeShippingThreshold);
                        setShippingCost(data.settings.shippingCost);
                        setWhatsappNumber(data.settings.whatsappNumber);
                        setAmazonLink(data.settings.amazonLink);
                        setDataLoaded(true);
                        setDebugInfo(`âœ… Loaded ${data.products.length} products with full admin access`);
                    }
                };

                initializeData();
            }, [isAuthenticated, supabaseStatus]);

            // Initialize Lucide icons - FIXED: Re-initialize after dynamic content changes
            useEffect(() => {
                const initializeIcons = () => {
                    if (window.lucide) {
                        window.lucide.createIcons();
                    }
                };
                
                initializeIcons();
                
                // Re-initialize icons when content changes
                const observer = new MutationObserver(initializeIcons);
                observer.observe(document.getElementById('root'), {
                    childList: true,
                    subtree: true
                });
                
                return () => observer.disconnect();
            }, []);

            // Check for saved session
            useEffect(() => {
                const savedAuth = sessionStorage.getItem('adminAuth');
                if (savedAuth === 'true') {
                    setIsAuthenticated(true);
                }
            }, []);

            const handleLogin = (e) => {
                e.preventDefault();
                if (password === ADMIN_PASSWORD) {
                    setIsAuthenticated(true);
                    sessionStorage.setItem('adminAuth', 'true');
                    setLoginError('');
                } else {
                    setLoginError('Incorrect password. Please try again.');
                    setPassword('');
                }
            };

            const handleLogout = () => {
                setIsAuthenticated(false);
                sessionStorage.removeItem('adminAuth');
                setPassword('');
                setDataLoaded(false);
                setDebugInfo('Logged out successfully');
            };

            const formatINR = (amount) => {
                return new Intl.NumberFormat('en-IN', {
                    style: 'currency',
                    currency: 'INR',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0,
                }).format(amount);
            };

            const handleImageUpload = (productId, event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setProducts(products.map(p => 
                            p.id === productId ? { ...p, image: reader.result } : p
                        ));
                    };
                    reader.readAsDataURL(file);
                }
            };

            const updateProduct = (id, field, value) => {
                setProducts(products.map(p => 
                    p.id === id ? { ...p, [field]: value } : p
                ));
            };

            const addNewProduct = () => {
                const tempId = `temp-${Date.now()}`;
                tempIdTracker.current.add(tempId);
                
                const newProduct = {
                    id: tempId,
                    title: 'New Product',
                    category: 'Actuation',
                    price: 0,
                    description: 'Product description goes here...',
                    image: 'https://placehold.co/400x300/eeeeee/333333?text=New+Product',
                    amazon_link: '',
                    flipkart_link: ''
                };
                setProducts([...products, newProduct]);
                setEditingProduct(newProduct.id);
            };

            const deleteProduct = async (id) => {
                if (window.confirm('Are you sure you want to delete this product?')) {
                    // Skip if it's a temporary product
                    if (id.toString().startsWith('temp-')) {
                        setProducts(products.filter(p => p.id !== id));
                        tempIdTracker.current.delete(id);
                        if (editingProduct === id) setEditingProduct(null);
                        return;
                    }

                    // Delete from Supabase
                    if (supabase && supabaseStatus === 'connected') {
                        const { error } = await supabase
                            .from('products')
                            .delete()
                            .eq('id', id);
                        
                        if (error) {
                            console.error('Error deleting product:', error);
                            alert('Error deleting product: ' + error.message);
                            return;
                        }
                    }
                    
                    setProducts(products.filter(p => p.id !== id));
                    if (editingProduct === id) setEditingProduct(null);
                    
                    setDebugInfo('Product deleted successfully from database');
                }
            };

            // Save settings to Supabase
            const saveSettingsToSupabase = async (settings) => {
                if (supabase && supabaseStatus === 'connected') {
                    const { error } = await supabase
                        .from('settings')
                        .upsert({ id: 1, ...settings }, { onConflict: 'id' });
                    
                    if (error) {
                        console.error('Error saving settings:', error);
                        setDebugInfo('Settings save error: ' + error.message);
                        return false;
                    }
                    return true;
                }
                return false;
            };

            const saveChanges = async () => {
                setSavedNotification(true);
                setDebugInfo('Saving changes with admin privileges...');
                
                const settingsToSave = {
                    freeShippingThreshold,
                    shippingCost,
                    whatsappNumber,
                    amazonLink
                };

                try {
                    let savedProducts = 0;
                    const updatedProducts = [...products];

                    // Save products to Supabase - FIXED: Prevent race condition
                    if (supabase && supabaseStatus === 'connected') {
                        for (let i = 0; i < updatedProducts.length; i++) {
                            const product = updatedProducts[i];
                            const productData = {
                                title: product.title,
                                price: product.price,
                                image: product.image,
                                description: product.description,
                                category: product.category || 'Actuation', // FIXED: Ensure category is always defined
                                amazon_link: product.amazon_link || '',
                                flipkart_link: product.flipkart_link || ''
                            };

                            if (product.id.toString().startsWith('temp-') && tempIdTracker.current.has(product.id)) {
                                // New product - insert
                                const { data, error } = await supabase
                                    .from('products')
                                    .insert(productData)
                                    .select()
                                    .single();
                                
                                if (error) {
                                    console.error('Error inserting product:', error);
                                    setDebugInfo('Product insert error: ' + error.message);
                                } else if (data) {
                                    // Update local ID with the real UUID from Supabase
                                    updatedProducts[i] = { ...data };
                                    tempIdTracker.current.delete(product.id);
                                    savedProducts++;
                                }
                            } else if (!product.id.toString().startsWith('temp-')) {
                                // Existing product - update
                                const { error } = await supabase
                                    .from('products')
                                    .update(productData)
                                    .eq('id', product.id);
                                
                                if (error) {
                                    console.error('Error updating product:', error);
                                    setDebugInfo('Product update error: ' + error.message);
                                } else {
                                    savedProducts++;
                                }
                            }
                        }

                        // Update state with cleaned products (no temp IDs)
                        setProducts(updatedProducts.filter(p => !p.id.toString().startsWith('temp-') || !tempIdTracker.current.has(p.id)));

                        // Save settings to Supabase
                        await saveSettingsToSupabase(settingsToSave);
                        
                        setDebugInfo(`âœ… Successfully saved ${savedProducts} products and settings to database!`);
                    }

                    // Always save to localStorage as backup
                    localStorage.setItem('robotechniqueSettings', JSON.stringify(settingsToSave));
                    localStorage.setItem('robotechniqueData', JSON.stringify({
                        products: updatedProducts.filter(p => !p.id.toString().startsWith('temp-') || !tempIdTracker.current.has(p.id)),
                        settings: settingsToSave,
                        lastUpdated: new Date().toISOString()
                    }));
                    
                } catch (error) {
                    console.error('Error saving data:', error);
                    setDebugInfo('Save error: ' + error.message);
                }
                
                setTimeout(() => setSavedNotification(false), 3000);
            };

            const exportData = () => {
                const dataStr = JSON.stringify({
                    products,
                    settings: {
                        freeShippingThreshold,
                        shippingCost,
                        whatsappNumber,
                        amazonLink
                    }
                }, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'robotechnique-data.json';
                link.click();
            };

            const resetToDefaults = async () => {
                if (window.confirm('Are you sure you want to reset all data to defaults? This cannot be undone.')) {
                    // Clear products from Supabase
                    if (supabase && supabaseStatus === 'connected') {
                        try {
                            const { error } = await supabase
                                .from('products')
                                .delete()
                                .neq('id', '00000000-0000-0000-0000-000000000000');
                            
                            if (error) {
                                console.error('Error clearing products:', error);
                            }
                            
                            // Reset settings in Supabase
                            const defaultSettings = getDefaultSettings();
                            await saveSettingsToSupabase({ id: 1, ...defaultSettings });
                        } catch (error) {
                            console.error('Error resetting data:', error);
                        }
                    }
                    
                    // Reset local state
                    setProducts([]);
                    tempIdTracker.current.clear();
                    const defaultSettings = getDefaultSettings();
                    setFreeShippingThreshold(defaultSettings.freeShippingThreshold);
                    setShippingCost(defaultSettings.shippingCost);
                    setWhatsappNumber(defaultSettings.whatsappNumber);
                    setAmazonLink(defaultSettings.amazonLink);
                    
                    // Clear localStorage
                    localStorage.removeItem('robotechniqueData');
                    localStorage.removeItem('robotechniqueSettings');
                    
                    setDebugInfo('Data reset to defaults');
                    
                    // FIXED: Reload data after reset
                    setTimeout(() => {
                        loadInitialData().then(data => {
                            setProducts(data.products);
                            setFreeShippingThreshold(data.settings.freeShippingThreshold);
                            setShippingCost(data.settings.shippingCost);
                            setWhatsappNumber(data.settings.whatsappNumber);
                            setAmazonLink(data.settings.amazonLink);
                        });
                    }, 500);
                }
            };

            // Database Status Indicator
            const DatabaseStatus = () => {
                if (supabaseStatus === 'loading') {
                    return React.createElement('div', {
                        className: "flex items-center gap-2 text-yellow-600 text-sm"
                    },
                        React.createElement('i', { 'data-lucide': 'loader', className: "w-4 h-4 animate-spin" }),
                        "Connecting to database..."
                    );
                }
                
                if (supabaseStatus === 'connected') {
                    return React.createElement('div', {
                        className: "flex items-center gap-2 text-green-600 text-sm"
                    },
                        React.createElement('i', { 'data-lucide': 'shield', className: "w-4 h-4" }),
                        `Admin Access - ${products.length} products`
                    );
                }
                
                return React.createElement('div', {
                    className: "flex items-center gap-2 text-red-600 text-sm"
                },
                    React.createElement('i', { 'data-lucide': 'alert-circle', className: "w-4 h-4" }),
                    "Database Offline"
                );
            };

            // Debug Info Component
            const DebugInfo = () => {
                if (!debugInfo) return null;
                
                return React.createElement('div', {
                    className: "mt-2 p-3 bg-blue-50 rounded-lg text-xs font-mono text-blue-700 max-w-md border border-blue-200"
                }, debugInfo);
            };

            // LOGIN SCREEN
            if (!isAuthenticated) {
                return React.createElement('div', {
                    className: "min-h-screen bg-gradient-to-br from-sky-50 via-white to-orange-50 flex items-center justify-center p-4"
                }, 
                    React.createElement('div', { className: "max-w-md w-full" },
                       
                    // Logo + Title
                    React.createElement('div', { className: "text-center mb-8" },
                        React.createElement('img', { 
                           src: "logo.jpg",
                           alt: "RoboTech Logo",
                           className: "w-20 h-20 mx-auto mb-4 rounded-xl shadow-md object-contain"
                        }),

                        React.createElement('h1', { className: "text-4xl font-extrabold text-gray-900 mb-2" },
                          'Robo',
                           React.createElement('span', { className: "text-orange-500" }, 'T'),
                           React.createElement('span', { className: "text-sky-600" }, 'echnique')
                        ),
                        React.createElement('p', { className: "text-gray-600 font-semibold" }, "Admin Access Portal")
                    ),

                        // Login Form
                        React.createElement('div', { className: "bg-white rounded-2xl shadow-2xl p-8 border-2 border-gray-100" },
                            React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6 text-center" }, "Secure Login"),
                            
                            React.createElement('div', { className: "space-y-6" },
                                React.createElement('div', null,
                                    React.createElement('label', {
                                        htmlFor: "password",
                                        className: "block text-sm font-bold text-gray-700 mb-2"
                                    }, "Admin Password"),
                                    React.createElement('div', { className: "relative" },
                                        React.createElement('input', {
                                            type: showPassword ? "text" : "password",
                                            id: "password",
                                            value: password,
                                            onChange: (e) => setPassword(e.target.value),
                                            onKeyPress: (e) => e.key === 'Enter' && handleLogin(e),
                                            className: "w-full px-4 py-3 pr-12 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition",
                                            placeholder: "Enter your password"
                                        }),
                                        React.createElement('button', {
                                            type: "button",
                                            onClick: () => setShowPassword(!showPassword),
                                            className: "absolute right-3 top-3.5 text-gray-500 hover:text-gray-700"
                                        },
                                            showPassword ? 
                                                React.createElement('i', { 'data-lucide': 'eye-off', className: "w-5 h-5" }) :
                                                React.createElement('i', { 'data-lucide': 'eye', className: "w-5 h-5" })
                                        )
                                    )
                                ),

                                loginError && React.createElement('div', {
                                    className: "bg-red-50 border-l-4 border-red-500 p-4 rounded"
                                },
                                    React.createElement('p', { className: "text-red-700 text-sm font-semibold" }, loginError)
                                ),

                                React.createElement('button', {
                                    onClick: handleLogin,
                                    className: "w-full bg-sky-600 text-white py-3 rounded-lg font-bold hover:bg-sky-700 transition shadow-lg hover:shadow-xl transform hover:scale-105"
                                }, "Access Admin Panel")
                            ),

                            React.createElement('div', { className: "mt-6 pt-6 border-t border-gray-200" },
                                React.createElement('p', { className: "text-xs text-gray-500 text-center" },
                                    "ðŸ”’ Secure connection â€¢ For authorized personnel only"
                                )
                            )
                        )
                    )
                );
            }

            // Show loading while data is being loaded
            if (!dataLoaded) {
                return React.createElement('div', {
                    className: "min-h-screen bg-gray-50 flex items-center justify-center"
                },
                    React.createElement('div', { className: "text-center" },
                        React.createElement('i', { 'data-lucide': 'loader', className: "w-12 h-12 text-sky-600 animate-spin mx-auto mb-4" }),
                        React.createElement('p', { className: "text-gray-600 font-semibold" }, "Loading data..."),
                        React.createElement(DebugInfo)
                    )
                );
            }

            // MAIN ADMIN PANEL
            return React.createElement('div', { className: "min-h-screen bg-gray-50" },
                // Header
                React.createElement('div', { className: "bg-gradient-to-r from-sky-600 to-sky-700 shadow-lg" },
                    React.createElement('div', { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8" },
                        React.createElement('div', { className: "flex justify-between items-center py-5" },
                            React.createElement('div', null,
                                React.createElement('h1', { className: "text-3xl font-extrabold text-white tracking-tight" },
                                    'Robo',
                                    React.createElement('span', { className: "text-orange-400" }, 'T'),
                                    'echnique Admin'
                                ),
                                React.createElement('p', { className: "text-sky-100 text-sm mt-1" }, "Manage your robotics store"),
                                React.createElement(DatabaseStatus),
                                React.createElement(DebugInfo)
                            ),
                            React.createElement('div', { className: "flex gap-3" },
                                React.createElement('button', {
                                    onClick: resetToDefaults,
                                    className: "bg-yellow-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-yellow-600 transition font-semibold shadow-md"
                                }, "Reset All"),
                                React.createElement('button', {
                                    onClick: exportData,
                                    className: "bg-white text-sky-600 px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-sky-50 transition font-semibold shadow-md"
                                }, "Export Data"),
                                React.createElement('button', {
                                    onClick: saveChanges,
                                    className: "bg-orange-500 text-white px-6 py-2 rounded-lg flex items-center gap-2 hover:bg-orange-600 transition font-bold shadow-lg"
                                },
                                    React.createElement('i', { 'data-lucide': 'save', className: "w-4 h-4" }),
                                    "Save All"
                                ),
                                React.createElement('button', {
                                    onClick: handleLogout,
                                    className: "bg-red-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-red-600 transition font-semibold shadow-md"
                                },
                                    React.createElement('i', { 'data-lucide': 'log-out', className: "w-4 h-4" }),
                                    "Logout"
                                )
                            )
                        )
                    )
                ),

                // Save Notification
                savedNotification && React.createElement('div', {
                    className: "fixed top-24 right-4 bg-green-500 text-white px-6 py-4 rounded-xl shadow-2xl z-50 flex items-center gap-3 animate-pulse"
                },
                    React.createElement('i', { 'data-lucide': 'check', className: "w-5 h-5" }),
                    React.createElement('span', { className: "font-bold" }, "Changes saved to database!")
                ),

                React.createElement('div', { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" },
                    // Tabs
                    React.createElement('div', { className: "flex gap-2 mb-8 border-b-2 border-gray-200" },
                        React.createElement('button', {
                            onClick: () => setActiveTab('products'),
                            className: `pb-4 px-6 font-bold transition relative ${
                                activeTab === 'products'
                                    ? 'text-sky-600'
                                    : 'text-gray-500 hover:text-gray-700'
                            }`
                        },
                            React.createElement('div', { className: "flex items-center gap-2" },
                                React.createElement('i', { 'data-lucide': 'package', className: "w-5 h-5" }),
                                `Products (${products.length})`
                            ),
                            activeTab === 'products' && React.createElement('div', {
                                className: "absolute bottom-0 left-0 right-0 h-1 bg-sky-600 rounded-t"
                            })
                        ),
                        React.createElement('button', {
                            onClick: () => setActiveTab('settings'),
                            className: `pb-4 px-6 font-bold transition relative ${
                                activeTab === 'settings'
                                    ? 'text-sky-600'
                                    : 'text-gray-500 hover:text-gray-700'
                            }`
                        },
                            React.createElement('div', { className: "flex items-center gap-2" },
                                React.createElement('i', { 'data-lucide': 'settings', className: "w-5 h-5" }),
                                "Site Settings"
                            ),
                            activeTab === 'settings' && React.createElement('div', {
                                className: "absolute bottom-0 left-0 right-0 h-1 bg-sky-600 rounded-t"
                            })
                        )
                    ),

                    // Products Tab
                    activeTab === 'products' && React.createElement('div', null,
                        React.createElement('div', { className: "flex justify-between items-center mb-6" },
                            React.createElement('h2', { className: "text-2xl font-bold text-gray-800" }, "Product Management"),
                            React.createElement('button', {
                                onClick: addNewProduct,
                                className: "bg-sky-600 text-white px-5 py-3 rounded-xl flex items-center gap-2 hover:bg-sky-700 transition font-bold shadow-lg"
                            },
                                React.createElement('i', { 'data-lucide': 'plus', className: "w-5 h-5" }),
                                "Add New Product"
                            )
                        ),

                        // Product Grid View
                        !editingProduct && React.createElement('div', {
                            className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"
                        },
                            products.map(product => 
                                React.createElement('div', {
                                    key: product.id,
                                    onClick: () => setEditingProduct(product.id),
                                    className: "bg-white rounded-xl shadow-md p-4 border-2 border-gray-100 hover:border-sky-400 hover:shadow-xl transition cursor-pointer transform hover:scale-105"
                                },
                                    React.createElement('img', {
                                        src: product.image,
                                        alt: product.title,
                                        className: "w-full h-32 object-cover rounded-lg mb-3"
                                    }),
                                    React.createElement('h3', {
                                        className: "font-bold text-gray-800 text-sm mb-1 truncate"
                                    }, product.title),
                                    React.createElement('span', {
                                        className: "text-xs font-semibold text-sky-600 uppercase"
                                    }, product.category || 'Uncategorized'),
                                    React.createElement('p', {
                                        className: "text-lg font-extrabold text-gray-900 mt-2"
                                    }, formatINR(product.price)),
                                    React.createElement('div', { className: "mt-3 text-center" },
                                        React.createElement('span', {
                                            className: "text-xs text-sky-600 font-semibold"
                                        }, "Click to Edit")
                                    )
                                )
                            )
                        ),

                        // Editing Mode - Full Details
                        editingProduct && React.createElement('div', { className: "mb-6" },
                            React.createElement('button', {
                                onClick: () => setEditingProduct(null),
                                className: "mb-4 text-sky-600 hover:text-sky-700 font-semibold flex items-center gap-2"
                            },
                                React.createElement('i', { 'data-lucide': 'x', className: "w-4 h-4" }),
                                "Back to Grid View"
                            ),
                            React.createElement('div', {
                                className: "bg-white rounded-xl shadow-lg p-6 border-2 border-sky-200"
                            },
                                products.filter(p => p.id === editingProduct).map(product => 
                                    React.createElement(React.Fragment, { key: product.id },
                                        React.createElement('div', { className: "grid md:grid-cols-4 gap-6" },
                                            // Image Section
                                            React.createElement('div', null,
                                                React.createElement('label', {
                                                    className: "block text-sm font-bold text-gray-700 mb-2"
                                                }, "Product Image"),
                                                React.createElement('div', { className: "relative group" },
                                                    React.createElement('img', {
                                                        src: product.image,
                                                        alt: product.title,
                                                        className: "w-full h-40 object-cover rounded-lg border-2 border-gray-200"
                                                    }),
                                                    React.createElement('label', {
                                                        className: "absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg cursor-pointer opacity-0 group-hover:opacity-100 transition"
                                                    },
                                                        React.createElement('div', { className: "text-white text-center" },
                                                            React.createElement('i', { 'data-lucide': 'upload', className: "w-8 h-8 mx-auto mb-2" }),
                                                            React.createElement('span', { className: "text-sm font-semibold" }, "Upload New")
                                                        ),
                                                        React.createElement('input', {
                                                            type: "file",
                                                            accept: "image/*",
                                                            onChange: (e) => handleImageUpload(product.id, e),
                                                            className: "hidden"
                                                        })
                                                    )
                                                )
                                            ),

                                            // Details Section
                                            React.createElement('div', { className: "md:col-span-3" },
                                                React.createElement('div', { className: "grid md:grid-cols-2 gap-4 mb-4" },
                                                    React.createElement('div', null,
                                                        React.createElement('label', {
                                                            className: "block text-sm font-bold text-gray-700 mb-1"
                                                        }, "Product Name"),
                                                        React.createElement('input', {
                                                            type: "text",
                                                            value: product.title,
                                                            onChange: (e) => updateProduct(product.id, 'title', e.target.value),
                                                            className: "w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"
                                                        })
                                                    ),

                                                    React.createElement('div', null,
                                                        React.createElement('label', {
                                                            className: "block text-sm font-bold text-gray-700 mb-1"
                                                        }, "Category"),
                                                        React.createElement('select', {
                                                            value: product.category || 'Actuation',
                                                            onChange: (e) => updateProduct(product.id, 'category', e.target.value),
                                                            className: "w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"
                                                        },
                                                            categories.map(cat => 
                                                                React.createElement('option', { key: cat, value: cat }, cat)
                                                            )
                                                        )
                                                    ),

                                                    React.createElement('div', null,
                                                        React.createElement('label', {
                                                            className: "block text-sm font-bold text-gray-700 mb-1"
                                                        }, "Price (â‚¹)"),
                                                        React.createElement('div', { className: "relative" },
                                                            React.createElement('span', {
                                                                className: "absolute left-3 top-2.5 text-gray-500 font-bold"
                                                            }, "â‚¹"),
                                                            React.createElement('input', {
                                                                type: "number",
                                                                step: "1",
                                                                value: product.price,
                                                                onChange: (e) => updateProduct(product.id, 'price', parseInt(e.target.value) || 0),
                                                                className: "w-full pl-8 pr-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"
                                                            })
                                                        ),
                                                        React.createElement('p', {
                                                            className: "text-xs text-gray-500 mt-1"
                                                        }, `Display: ${formatINR(product.price)}`)
                                                    ),

                                                    React.createElement('div', null,
                                                        React.createElement('label', {
                                                            className: "block text-sm font-bold text-gray-700 mb-1"
                                                        }, "Image URL"),
                                                        React.createElement('input', {
                                                            type: "text",
                                                            value: product.image,
                                                            onChange: (e) => updateProduct(product.id, 'image', e.target.value),
                                                            className: "w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition text-sm"
                                                        })
                                                    )
                                                ),

                                                // NEW: Amazon & Flipkart Links Section
                                                React.createElement('div', { className: "mb-4" },
                                                    React.createElement('h3', { 
                                                        className: "text-lg font-bold text-gray-800 mb-3 flex items-center gap-2"
                                                    },
                                                        React.createElement('i', { 'data-lucide': 'shopping-bag', className: "w-5 h-5 text-sky-600" }),
                                                        "Product Links"
                                                    ),
                                                    React.createElement('div', { className: "grid md:grid-cols-2 gap-4" },
                                                        React.createElement('div', null,
                                                            React.createElement('label', {
                                                                className: "block text-sm font-bold text-gray-700 mb-1"
                                                            }, "Amazon Product Link"),
                                                            React.createElement('input', {
                                                                type: "url",
                                                                value: product.amazon_link || '',
                                                                onChange: (e) => updateProduct(product.id, 'amazon_link', e.target.value),
                                                                placeholder: "https://amazon.in/dp/PRODUCT_ID",
                                                                className: "w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition text-sm"
                                                            })
                                                        ),
                                                        React.createElement('div', null,
                                                            React.createElement('label', {
                                                                className: "block text-sm font-bold text-gray-700 mb-1"
                                                            }, "Flipkart Product Link"),
                                                            React.createElement('input', {
                                                                type: "url",
                                                                value: product.flipkart_link || '',
                                                                onChange: (e) => updateProduct(product.id, 'flipkart_link', e.target.value),
                                                                placeholder: "https://flipkart.com/product/PRODUCT_ID",
                                                                className: "w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition text-sm"
                                                            })
                                                        )
                                                    ),
                                                    React.createElement('p', {
                                                        className: "text-xs text-gray-500 mt-2"
                                                    }, "Leave empty to hide from product card")
                                                ),

                                                React.createElement('div', { className: "mb-4" },
                                                    React.createElement('label', {
                                                        className: "block text-sm font-bold text-gray-700 mb-1"
                                                    }, "Description"),
                                                    React.createElement('textarea', {
                                                        value: product.description,
                                                        onChange: (e) => updateProduct(product.id, 'description', e.target.value),
                                                        rows: "3",
                                                        className: "w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition resize-none"
                                                    })
                                                ),

                                                React.createElement('div', { className: "flex justify-end" },
                                                    React.createElement('button', {
                                                        onClick: () => deleteProduct(product.id),
                                                        className: "px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition flex items-center gap-2 font-semibold"
                                                    },
                                                        React.createElement('i', { 'data-lucide': 'trash-2', className: "w-4 h-4" }),
                                                        "Delete Product"
                                                    )
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    ),

                    // Settings Tab
                    activeTab === 'settings' && React.createElement('div', { className: "max-w-3xl" },
                        React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6" }, "Site Settings"),

                        React.createElement('div', { className: "space-y-6" },
                            // Shipping Settings
                            React.createElement('div', {
                                className: "bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100"
                            },
                                React.createElement('div', { className: "flex items-center gap-3 mb-4" },
                                    React.createElement('i', { 'data-lucide': 'truck', className: "w-6 h-6 text-sky-600" }),
                                    React.createElement('h3', { className: "text-xl font-bold text-gray-800" }, "Shipping Configuration")
                                ),

                                React.createElement('div', { className: "space-y-4" },
                                    React.createElement('div', null,
                                        React.createElement('label', {
                                            className: "block text-sm font-bold text-gray-700 mb-2"
                                        }, "Free Shipping Threshold (â‚¹)"),
                                        React.createElement('div', { className: "relative" },
                                            React.createElement('span', {
                                                className: "absolute left-3 top-3 text-gray-500 font-bold"
                                            }, "â‚¹"),
                                            React.createElement('input', {
                                                type: "number",
                                                step: "100",
                                                value: freeShippingThreshold,
                                                onChange: (e) => setFreeShippingThreshold(parseInt(e.target.value) || 0),
                                                className: "w-full pl-8 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"
                                            })
                                        ),
                                        React.createElement('p', {
                                            className: "text-sm text-gray-600 mt-2"
                                        }, `Orders above ${formatINR(freeShippingThreshold)} get free shipping`)
                                    ),

                                    React.createElement('div', null,
                                        React.createElement('label', {
                                            className: "block text-sm font-bold text-gray-700 mb-2"
                                        }, "Standard Shipping Cost (â‚¹)"),
                                        React.createElement('div', { className: "relative" },
                                            React.createElement('span', {
                                                className: "absolute left-3 top-3 text-gray-500 font-bold"
                                            }, "â‚¹"),
                                            React.createElement('input', {
                                                type: "number",
                                                step: "10",
                                                value: shippingCost,
                                                onChange: (e) => setShippingCost(parseInt(e.target.value) || 0),
                                                className: "w-full pl-8 pr-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"
                                            })
                                        ),
                                        React.createElement('p', {
                                            className: "text-sm text-gray-600 mt-2"
                                        }, "Charged for orders below the free shipping threshold")
                                    )
                                )
                            ),

                            // Contact Settings
                            React.createElement('div', {
                                className: "bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100"
                            },
                                React.createElement('div', { className: "flex items-center gap-3 mb-4" },
                                    React.createElement('i', { 'data-lucide': 'phone', className: "w-6 h-6 text-sky-600" }),
                                    React.createElement('h3', { className: "text-xl font-bold text-gray-800" }, "WhatsApp Business Number")
                                ),

                                React.createElement('div', null,
                                    React.createElement('label', {
                                        className: "block text-sm font-bold text-gray-700 mb-2"
                                    }, "Phone Number (with country code, no spaces)"),
                                    React.createElement('input', {
                                        type: "text",
                                        value: whatsappNumber,
                                        onChange: (e) => setWhatsappNumber(e.target.value.replace(/\D/g, '')),
                                        placeholder: "919718335330",
                                        className: "w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition font-mono"
                                    }),
                                    React.createElement('p', {
                                        className: "text-sm text-gray-600 mt-2"
                                    }, "Example: 919718335330 for +91 97183 35330")
                                )
                            ),

                            // Amazon Link
                            React.createElement('div', {
                                className: "bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100"
                            },
                                React.createElement('div', { className: "flex items-center gap-3 mb-4" },
                                    React.createElement('i', { 'data-lucide': 'link-2', className: "w-6 h-6 text-sky-600" }),
                                    React.createElement('h3', { className: "text-xl font-bold text-gray-800" }, "Default Amazon Seller Link")
                                ),

                                React.createElement('div', null,
                                    React.createElement('label', {
                                        className: "block text-sm font-bold text-gray-700 mb-2"
                                    }, "Amazon Storefront URL"),
                                    React.createElement('input', {
                                        type: "url",
                                        value: amazonLink,
                                        onChange: (e) => setAmazonLink(e.target.value),
                                        className: "w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition text-sm"
                                    }),
                                    React.createElement('p', {
                                        className: "text-sm text-gray-600 mt-2"
                                    }, "Used as fallback when product-specific Amazon link is not set")
                                )
                            )
                        )
                    )
                )
            );
        }

        // Render the app
        ReactDOM.render(React.createElement(AdminPanel), document.getElementById('root'));
    </script>
</body>
</html>